<!DOCTYPE html> 
<html lang="en"> 
<head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>Loan Application</title> 
  <script src="https://cdn.tailwindcss.com"></script> 
</head> 
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4"> 
 
  <div class="bg-white shadow-xl rounded-2xl p-6 md:p-8 w-full max-w-7xl"> 
    
    <div class="border-b pb-4 mb-6">
        <h2 class="text-3xl font-bold text-gray-800">Loan Application Form</h2> 
        <p class="text-gray-500 mt-1">Please fill in your details below. Fields marked * are mandatory.</p>
    </div>
 
    <form id="loanForm"> 
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

        <div class="md:col-span-3">
            <h3 class="text-lg font-semibold text-blue-600 mb-3 uppercase tracking-wide">Personal Details</h3>
        </div>

        <div> 
            <label for="name" class="block text-gray-700 font-medium mb-1">Full Name</label> 
            <input type="text" id="name" name="name" required 
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition"> 
        </div> 
    
        <div>
            <label for="dob" class="block text-gray-700 font-medium mb-1">Date of Birth</label>
            <input type="date" id="dob" name="dob" required
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
        </div>

        <div>
            <label for="pan" class="block text-gray-700 font-medium mb-1">PAN Number</label>
            <input type="text" id="pan" name="pan" required pattern="[A-Z]{5}[0-9]{4}[A-Z]{1}" title="Format: ABCDE1234F" placeholder="ABCDE1234F"
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition uppercase">
        </div>

        <div class="md:col-span-3 mt-2">
            <h3 class="text-lg font-semibold text-blue-600 mb-3 uppercase tracking-wide">Contact Details</h3>
        </div>

        <div> 
            <label for="email" class="block text-gray-700 font-medium mb-1">Email</label> 
            <input type="email" id="email" name="email" required 
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition"> 
        </div> 

        <div>
            <label for="mobile" class="block text-gray-700 font-medium mb-1">Mobile Number</label>
            <div class="flex">
                <select id="countryCode" name="countryCode" class="px-3 py-2 border border-gray-300 rounded-l-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="+91">+91 (IN)</option>
                </select>
                <input type="tel" id="mobile" name="mobile" required pattern="\d{10}" title="10 digits required" placeholder="9876543210"
                       class="w-full px-4 py-2 border border-gray-300 rounded-r-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
            </div>
        </div>

        <div class="md:col-span-3 mt-2 bg-gray-50 p-4 rounded-xl border border-gray-200">
            <h3 class="text-lg font-semibold text-blue-600 mb-4 uppercase tracking-wide">Residential Address</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label for="doorNo" class="block text-gray-700 font-medium mb-1">Door No.</label>
                    <input type="text" id="doorNo" name="doorNo" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white">
                </div>
                <div class="md:col-span-2">
                    <label for="street" class="block text-gray-700 font-medium mb-1">Street Name</label>
                    <input type="text" id="street" name="street" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white">
                </div>
                <div>
                    <label for="city" class="block text-gray-700 font-medium mb-1">City</label>
                    <input type="text" id="city" name="city" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white">
                </div>
                <div>
                    <label for="district" class="block text-gray-700 font-medium mb-1">District</label>
                    <select id="district" name="district" required
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white">
                        <option value="">Select District</option>
                        </select>
                </div>
                <div>
                    <label for="state" class="block text-gray-700 font-medium mb-1">State</label>
                    <input type="text" id="state" name="state" value="Tamil Nadu" readonly
                        class="w-full px-4 py-2 border border-gray-300 bg-gray-200 text-gray-600 rounded-lg cursor-not-allowed">
                </div>
                <div>
                    <label for="postalCode" class="block text-gray-700 font-medium mb-1">Postal Code</label>
                    <input type="tel" id="postalCode" name="postalCode" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white">
                </div>
            </div>
        </div>

        <div class="md:col-span-3 mt-2">
            <h3 class="text-lg font-semibold text-blue-600 mb-3 uppercase tracking-wide">Financial Information</h3>
        </div>

        <div> 
            <label for="annualIncome" class="block text-gray-700 font-medium mb-1">Annual Income (₹)</label> 
            <input type="number" id="annualIncome" name="annualIncome" required min="0"
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
                   placeholder="e.g. 500000"> 
            <p id="incomeError" class="text-red-500 text-xs hidden mt-1">Min income required: ₹3,00,000</p>
        </div> 
    
        <div> 
            <label for="type" class="block text-gray-700 font-medium mb-1">Loan Type</label> 
            <select id="type" name="loanType" required 
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition"> 
                <option value="">Select Loan Type</option> 
                <option value="Home Loan">Home Loan</option> 
                <option value="Education Loan">Education Loan</option> 
                <option value="Personal Loan">Personal Loan</option> 
            </select> 
        </div> 

        <div> 
            <label for="amount" class="block text-gray-700 font-medium mb-1">Loan Amount Required</label> 
            <input type="number" id="amount" name="loanAmount" required 
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition"> 
            <p id="eligibilityMsg" class="text-green-600 text-xs mt-1 h-4"></p>
        </div> 

      </div> <div class="mt-8 text-center">
          <button type="submit" id="submitBtn"
                  class="w-full md:w-1/3 bg-blue-600 text-white font-bold py-3 px-6 rounded-xl hover:bg-blue-700 transition duration-300 shadow-lg text-lg"> 
            Submit Application 
          </button> 
      </div>

    </form> 
  </div> 
 
  <script>
    // --- 1. POPULATE DISTRICTS ---
    const districts = [
      "Ariyalur", "Chengalpattu", "Chennai", "Coimbatore", "Cuddalore", "Dharmapuri", "Dindigul", 
      "Erode", "Kallakurichi", "Kanchipuram", "Kanyakumari", "Karur", "Krishnagiri", "Madurai", 
      "Mayiladuthurai", "Nagapattinam", "Namakkal", "Nilgiris", "Perambalur", "Pudukkottai", 
      "Ramanathapuram", "Ranipet", "Salem", "Sivaganga", "Tenkasi", "Thanjavur", "Theni", 
      "Thoothukudi", "Tiruchirappalli", "Tirunelveli", "Tirupathur", "Tiruppur", "Tiruvallur", 
      "Tiruvannamalai", "Tiruvarur", "Vellore", "Viluppuram", "Virudhunagar"
    ];

    const districtSelect = document.getElementById("district");
    districts.forEach(d => {
        const option = document.createElement("option");
        option.value = d;
        option.textContent = d;
        districtSelect.appendChild(option);
    });

    // --- 2. DOB VALIDATION (18+ Years) ---
    const dobInput = document.getElementById('dob');
    if (dobInput) {
        const today = new Date();
        const maxYear = today.getFullYear() - 18;
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const day = String(today.getDate()).padStart(2, '0');
        const maxDate = `${maxYear}-${month}-${day}`;
        dobInput.setAttribute('max', maxDate);
    }

    // --- 3. INCOME & LOAN ELIGIBILITY LOGIC ---
    const incomeInput = document.getElementById("annualIncome");
    const amountInput = document.getElementById("amount");
    const incomeError = document.getElementById("incomeError");
    const eligibilityMsg = document.getElementById("eligibilityMsg");
    const submitBtn = document.getElementById("submitBtn");

    incomeInput.addEventListener("input", function() {
        const income = parseFloat(this.value) || 0;
        const minIncome = 300000;

        if (income < minIncome) {
            incomeError.classList.remove("hidden");
            eligibilityMsg.textContent = "";
            submitBtn.disabled = true;
            submitBtn.classList.add("opacity-50", "cursor-not-allowed");
            amountInput.disabled = true;
            amountInput.value = "";
            amountInput.placeholder = "Not eligible";
        } else {
            incomeError.classList.add("hidden");
            submitBtn.disabled = false;
            submitBtn.classList.remove("opacity-50", "cursor-not-allowed");
            amountInput.disabled = false;
            
            const maxLoan = income * 2;
            amountInput.max = maxLoan;
            amountInput.placeholder = `Max: ₹${maxLoan}`;
            eligibilityMsg.textContent = `Eligible for up to ₹${maxLoan}`;
        }
    });

    amountInput.addEventListener("change", function() {
        const currentAmount = parseFloat(this.value) || 0;
        const maxAllowed = parseFloat(this.max) || 0;
        if(currentAmount > maxAllowed) {
            alert(`Maximum loan limit is ₹${maxAllowed}`);
            this.value = maxAllowed;
        }
    });

    // --- 4. FORM SUBMISSION ---
    document.getElementById("loanForm").addEventListener("submit", async function(e) {
      e.preventDefault();

      const income = parseFloat(incomeInput.value);
      if (income < 300000) {
          alert("Minimum income of 3 LPA required.");
          return;
      }

      const data = {
        name: document.getElementById("name").value,
        email: document.getElementById("email").value,
        dob: document.getElementById("dob").value,
        countryCode: document.getElementById("countryCode").value,
        mobile: document.getElementById("mobile").value,
        address: {
            doorNo: document.getElementById("doorNo").value,
            street: document.getElementById("street").value,
            city: document.getElementById("city").value,
            district: document.getElementById("district").value,
            state: document.getElementById("state").value, 
            postalCode: document.getElementById("postalCode").value,
        },
        pan: document.getElementById("pan").value,
        annualIncome: income,
        loanAmount: document.getElementById("amount").value,
        loanType: document.getElementById("type").value
      };

      try {
        submitBtn.textContent = "Processing...";
        submitBtn.disabled = true;
        
        const response = await fetch(
          "https://wzksu3sn48.execute-api.ap-south-1.amazonaws.com/prod/apply-loan",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
          }
        );

        const result = await response.json();

        if (response.status === 200) {
            alert("Application Submitted Successfully!");
            window.location.reload(); 
        } else if (response.status === 409) {
            alert("Error: " + result.message); 
        } else {
            alert("Submission failed: " + (result.message || "Unknown error"));
        }
      } catch (error) {
        console.error("ERROR:", error);
        alert("Network error. Please try again.");
      } finally {
        submitBtn.textContent = "Submit Application";
        submitBtn.disabled = false;
      }
    });
  </script>
 
</body> 
</html>
